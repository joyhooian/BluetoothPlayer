(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/load/load"],{"0583":function(e,i,n){"use strict";(function(e){n("29ac");t(n("66fd"));var i=t(n("f2de"));function t(e){return e&&e.__esModule?e:{default:e}}e(i.default)}).call(this,n("543d")["createPage"])},"0bf8":function(e,i,n){"use strict";var t;n.d(i,"b",(function(){return c})),n.d(i,"c",(function(){return a})),n.d(i,"a",(function(){return t}));var c=function(){var e=this,i=e.$createElement,n=(e._self._c,e.__map(e.musicInfo,(function(i,n){var t=e.__get_orig(i),c=i.name.length>12?i.name.substr(0,12):null;return{$orig:t,g0:c}})));e.$mp.data=Object.assign({},{$root:{l0:n}})},a=[]},"7bcd":function(e,i,n){"use strict";var t;Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var c={name:"load",data:function(){return{devices:[],primaryServiceUUID:"",readUUID:"",writeUUID:"",currentVolume:100,isShowVolume:!1,loading:!0,StatusBar:this.StatusBar,CustomBar:this.CustomBar,tempFile:[],musicInfo:[],innerAudioContext:null,curMusic:null,isMultiSelect:!1,isSelectedAll:!1,musicSelected:[],playModeIndex:0,playMode:["cuIcon-musicfill","cuIcon-refresh","cuIcon-order"],isPlaying:!1,remain:0,remainSec:0,remainMin:0,remainHour:0,remainString:"",ready4Play:!1}},computed:{playDisabled:function(){return 0==t.musicInfo.length}},methods:{ChangeVolume:function(e){null!=t.innerAudioContext.volume&&(t.innerAudioContext.volume=e.detail.value/100)},ShowVolume:function(){t.isShowVolume=!0},HideVolume:function(){t.isShowVolume=!1},MultiSelectStart:function(){t.isMultiSelect=!0},SelectAll:function(){t.musicInfo.forEach((function(e,i){e.isSelect=!0})),t.isSelectedAll=!0},SelectNothing:function(){t.musicInfo.forEach((function(e,i){e.isSelect=!1})),t.isSelectedAll=!1},MultiSelectCancel:function(){t.isMultiSelect=!1,t.SelectNothing()},deleteMusic:function(){for(var e=0;;)if(t.musicInfo[e].isSelect?t.musicInfo.splice(e,1):e++,null==t.musicInfo[e])break;0==t.musicInfo.length&&(t.isMultiSelect=!1)},MusicSelect:function(e){t.isMultiSelect?t.musicInfo[e.currentTarget.id].isSelect=!t.musicInfo[e.currentTarget.id].isSelect:(t.curMusic=e.currentTarget.id,getApp().globalData.curMusic=e.currentTarget.id,t.isPlaying&&(t.innerAudioContext.src=t.musicInfo[t.curMusic].path),t.clearRemain())},LastMusic:function(){var e=t.musicInfo.length;t.curMusic--,getApp().globalData.curMusic--,t.curMusic<0&&(t.curMusic=e-1,getApp().globalData.curMusic=e-1),t.isPlaying&&(t.innerAudioContext.src=t.musicInfo[t.curMusic].path,t.clearRemain())},NextMusic:function(){var e=t.musicInfo.length;t.curMusic++,getApp().globalData.curMusic++,t.curMusic>=e&&(t.curMusic,getApp().globalData.curMusic=0),t.isPlaying&&(t.innerAudioContext.src=t.musicInfo[t.curMusic].path,t.clearRemain())},ChangePlayMode:function(){switch(t.playModeIndex++,t.playModeIndex>=3&&(t.playModeIndex=0),t.playModeIndex){case 0:wx.showToast({title:"单次播放模式",icon:"none"});break;case 1:wx.showToast({title:"单曲循环模式",icon:"none"});break;case 2:wx.showToast({title:"全部循环模式",icon:"none"})}},PlayPause:function(){var e=this;if(null!=t.musicInfo[t.curMusic])if(t.isPlaying=!t.isPlaying,getApp().globalData.isPlaying=t.isPlaying,t.isPlaying)0!=this.devices.length&&(setTimeout((function(){wx.offBLECharacteristicValueChange(),wx.notifyBLECharacteristicValueChange({deviceId:e.devices[0].deviceId,serviceId:e.primaryServiceUUID,characteristicId:e.readUUID,state:!1})}),2e3),wx.notifyBLECharacteristicValueChange({deviceId:this.devices[0].deviceId,serviceId:this.primaryServiceUUID,characteristicId:this.readUUID,state:!0,success:function(e){wx.showToast({title:"打开监听Notify成功",icon:"none"})},fail:function(e){wx.showToast({title:"打开监听Nofity失败",icon:"none"})}}),wx.onBLECharacteristicValueChange((function(e){var i=new Uint8Array(e.value),n=[126,3,98,0,239];console.log("收到监听数据"),console.log(i);for(var c=0;c<i.length;c++)for(var a=0;a<5;a++){if(i[c+a]!=n[a])break;4==a&&(t.innerAudioContext.stop(),t.isPlaying=!1,getApp().globalData.isPlaying=!1,wx.setKeepScreenOn({keepScreenOn:!1}),t.clearRemain(),wx.showToast({title:"更换失败",icon:"none"}))}})),setTimeout((function(){var i=new Array;i.push(126),i.push(2),i.push(51),i.push(239);var n=new Uint8Array(i);wx.writeBLECharacteristicValue({deviceId:e.devices[0].deviceId,serviceId:e.primaryServiceUUID,characteristicId:e.writeUUID,value:n.buffer,success:function(){console.log("发送成功"),console.log(n.buffer)},fail:function(){console.log("发送失败")}})}),100)),t.innerAudioContext.src=t.musicInfo[t.curMusic].path,t.innerAudioContext.autoplay=!0,t.innerAudioContext.onCanplay((function(){t.innerAudioContext.duration,setTimeout((function(){t.musicInfo[t.curMusic].duration=t.innerAudioContext.duration,t.culculateRemain()}),10)})),setTimeout((function(){t.innerAudioContext.play(),wx.setKeepScreenOn({keepScreenOn:!0})}),500),t.innerAudioContext.onEnded((function(){if(t.clearRemain(),0==t.playModeIndex){t.isPlaying=!1,getApp().globalData.isPlaying=!1,wx.setKeepScreenOn({keepScreenOn:!1});var i=new Array;i.push(126),i.push(2),i.push(52),i.push(239);var n=new Uint8Array(i);setTimeout((function(){wx.writeBLECharacteristicValue({deviceId:e.devices[0].deviceId,serviceId:e.primaryServiceUUID,characteristicId:e.writeUUID,value:n.buffer,success:function(){console.log("发送成功"),console.log(n.buffer)},fail:function(){console.log("发送失败")}})}),1e3)}else 1==t.playModeIndex||(t.curMusic++,t.curMusic>t.musicInfo.length&&(t.curMusic=0),t.innerAudioContext.src=t.musicInfo[t.curMusic].path),t.innerAudioContext.play()})),t.innerAudioContext.onTimeUpdate((function(){t.culculateRemain()}));else{t.clearRemain(),t.innerAudioContext.stop();var i=new Array;i.push(126),i.push(2),i.push(52),i.push(239);var n=new Uint8Array(i);wx.writeBLECharacteristicValue({deviceId:this.devices[0].deviceId,serviceId:this.primaryServiceUUID,characteristicId:this.writeUUID,value:n.buffer,success:function(){console.log("发送成功"),console.log(n.buffer)},fail:function(){console.log("发送失败")}})}else wx.showToast({title:"请先导入音乐",icon:"none"})},culculateRemain:function(){t.remain=parseInt(t.innerAudioContext.duration-t.innerAudioContext.currentTime),t.remainSec=t.remain%60,t.remainMin=parseInt(t.remain/60),t.remainHour=parseInt(t.remain/3600),t.formatTime()},clearRemain:function(){t.remain=0,t.remainSec=0,t.remainMin=0,t.remainHour=0,t.formatTime()},formatTime:function(){t.remainString="",t.remainHour<10&&(t.remainString+="0"),t.remainString+=t.remainHour.toString()+":",t.remainMin<10&&(t.remainString+="0"),t.remainString+=t.remainMin.toString()+":",t.remainSec<10&&(t.remainString+="0"),t.remainString+=t.remainSec.toString()},importMusic:function(){wx.chooseMessageFile({count:10,type:"file",extension:["mp3","wma","flac","aac"],success:function(e){e.tempFiles.forEach((function(e){t.musicInfo.push({name:e.name,duration:null,path:e.path,isSelect:!1,currentTime:0})}))}})}},beforeCreate:function(){console.log("进入播放页面")},created:function(){t=this,t.tempFile=getApp().globalData.tempFile,t.musicInfo=getApp().globalData.musicInfo,t.innerAudioContext=getApp().globalData.innerAudioContext,t.curMusic=getApp().globalData.curMusic,t.isPlaying=getApp().globalData.isPlaying,this.devices=getApp().globalData.devices,this.primaryServiceUUID=getApp().globalData.primaryServiceUUID,this.readUUID=getApp().globalData.readUUID,this.writeUUID=getApp().globalData.writeUUID},mounted:function(){var e=this;if(0!=this.devices.length){wx.notifyBLECharacteristicValueChange({deviceId:this.devices[0].deviceId,serviceId:this.primaryServiceUUID,characteristicId:this.readUUID,state:!0,success:function(e){wx.showToast({title:"打开监听Notify成功",icon:"none"})},fail:function(e){wx.showToast({title:"打开监听Nofity失败",icon:"none"})}}),wx.onBLECharacteristicValueChange((function(i){wx.offBLECharacteristicValueChange();var n=new Uint8Array(i.value);console.log(n);for(var t=[126,2,51,239],c=0;c<n.length;c++)for(var a=0;a<4;a++){if(n[c+a]!=t[a])break;3==a&&(e.ready4Play=!0,wx.notifyBLECharacteristicValueChange({deviceId:e.devices[0].deviceId,serviceId:e.primaryServiceUUID,characteristicId:e.readUUID,state:!1}))}}));var i=new Array;i.push(126),i.push(2),i.push(50),i.push(239);var n=new Uint8Array(i);setTimeout((function(){wx.writeBLECharacteristicValue({deviceId:e.devices[0].deviceId,serviceId:e.primaryServiceUUID,characteristicId:e.writeUUID,value:n.buffer,success:function(e){console.log("发送成功"),console.log(n.buffer)},fail:function(){console.log("发送失败"),console.log(n.buffer)}})}),100)}else this.ready4Play=!0}};i.default=c},"7ca3":function(e,i,n){},"906f":function(e,i,n){"use strict";var t=n("7ca3"),c=n.n(t);c.a},ddd2:function(e,i,n){"use strict";n.r(i);var t=n("7bcd"),c=n.n(t);for(var a in t)"default"!==a&&function(e){n.d(i,e,(function(){return t[e]}))}(a);i["default"]=c.a},f2de:function(e,i,n){"use strict";n.r(i);var t=n("0bf8"),c=n("ddd2");for(var a in c)"default"!==a&&function(e){n.d(i,e,(function(){return c[e]}))}(a);n("906f");var r,o=n("f0c5"),u=Object(o["a"])(c["default"],t["b"],t["c"],!1,null,null,null,!1,t["a"],r);i["default"]=u.exports}},[["0583","common/runtime","common/vendor"]]]);