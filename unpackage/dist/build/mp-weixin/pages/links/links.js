(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/links/links"],{"0372":function(e,t,n){"use strict";n.r(t);var c=n("7290"),i=n("5ef4");for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);n("e2ab");var s,a=n("f0c5"),r=Object(a["a"])(i["default"],c["b"],c["c"],!1,null,null,null,!1,c["a"],s);t["default"]=r.exports},"5ef4":function(e,t,n){"use strict";n.r(t);var c=n("9784"),i=n.n(c);for(var o in c)"default"!==o&&function(e){n.d(t,e,(function(){return c[e]}))}(o);t["default"]=i.a},7290:function(e,t,n){"use strict";var c;n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return c}));var i=function(){var e=this,t=e.$createElement;e._self._c},o=[]},9784:function(e,t,n){"use strict";var c;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i={name:"links",data:function(){return{primaryServiceUUID:"",readUUID:"",writeUUID:"",searchingLoading:!1,devices:[]}},methods:{uploadTime:function(){var e=new Array,t=(new Date).toString().split(" ")[4].substr(0,2),n=(new Date).toString().split(" ")[4].substr(3,2),c=(new Date).getDay();e.push(126),e.push(4),e.push(18),e.push(Number(c)),e.push(Number(t)),e.push(Number(n)),e.push(239);var i=new Uint8Array(e);return i.buffer},autoLinkDevice:function(){this.searchingLoading||wx.getBluetoothAdapterState({success:function(e){e.available?(wx.onBLEConnectionStateChange((function(e){e.connected||(c.devices[0].status="disconnected",wx.showToast({title:"失去蓝牙链接",icon:"none"}))})),c.searchingLoading=!0,wx.startBluetoothDevicesDiscovery({success:function(e){setTimeout((function(){wx.getBluetoothDevices({success:function(e){console.log("搜索设备数目"+e.devices.length),console.log("设备信息\n"),e.devices.forEach((function(e,t){console.log(e),"JHY-SMART001"==e.name&&wx.createBLEConnection({deviceId:e.deviceId,success:function(t){console.log("设备"+e.name+"已连接"),wx.showToast({title:"设备"+e.name+"已连接",icon:"none"}),c.devices.splice(0,c.devices.length),c.devices.push({name:e.name,deviceId:e.deviceId,status:"connected",avatar:"static/bluetooth_con.png",services:[]}),c.isConnected=!0,c.devices.forEach((function(e,t){wx.getBLEDeviceServices({deviceId:e.deviceId,success:function(t){console.log(t),e.services=t.services,e.services.forEach((function(t){wx.getBLEDeviceCharacteristics({deviceId:e.deviceId,serviceId:t.uuid,success:function(e){t.characteristics=e.characteristics}})}))}})})),setTimeout((function(){c.SaveUUID(),console.log("UUDI: "+c.primaryServiceUUID+" write: "+c.writeUUID),""!=c.primaryServiceUUID&&""!=c.writeUUID&&setTimeout((function(){wx.writeBLECharacteristicValue({deviceId:c.devices[0].deviceId,serviceId:c.primaryServiceUUID,characteristicId:c.writeUUID,value:c.uploadTime(),success:function(e){console.log("发送成功 "+e.errMsg),console.log(e)},fail:function(e){console.log("发送失败 "+e.errMsg)}})}),1e3)}),1e3),wx.stopBluetoothDevicesDiscovery(),c.searchingLoading=!1},fail:function(){wx.showToast({title:"连接失败",icon:"none"}),console.log("连接失败"),c.searchingLoading=!1}})}))},complete:function(){wx.stopBluetoothDevicesDiscovery(),setTimeout((function(){c.searchingLoading=!1}),5e3)}})}),3e3)},fail:function(e){wx.stopBluetoothDevicesDiscovery()}})):wx.showToast({title:"请打开蓝牙功能",icon:"none"})},fail:function(){wx.showToast({title:"请打开蓝牙功能",icon:"none"})}})},disconnectDevice:function(e){var t=this;"connected"==c.devices[e.currentTarget.id].status?(c.devices[e.currentTarget.id].status="changingStatus",wx.offBLEConnectionStateChange(),wx.closeBLEConnection({deviceId:c.devices[e.currentTarget.id].deviceId,success:function(){c.devices[e.currentTarget.id].status="disconnected",console.log("已断开"),wx.showToast({title:"设备断开成功",icon:"none"}),c.devices[e.currentTarget.id].avatar="static/bluetooth.png"},fail:function(){c.devices[e.currentTarget.id].status="connected",console.log("断开失败"),wx.showToast({title:"设备断开失败",icon:"none"})}})):"disconnected"==c.devices[e.currentTarget.id].status&&(c.devices[e.currentTarget.id].status="changingStatus",wx.onBLEConnectionStateChange((function(e){e.connected||(c.devices[0].status="disconnected",wx.showToast({title:"失去蓝牙链接",icon:"none"}))})),wx.createBLEConnection({deviceId:c.devices[e.currentTarget.id].deviceId,success:function(){c.devices[e.currentTarget.id].status="connected",console.log("已连接"),wx.showToast({title:"设备已连接",icon:"none"}),c.devices[e.currentTarget.id].avatar="static/bluetooth_con.png",setTimeout((function(){wx.writeBLECharacteristicValue({deviceId:t.devices[0].deviceId,serviceId:t.primaryServiceUUID,characteristicId:t.writeUUID,value:t.uploadTime(),success:function(e){console.log("发送成功 "+e.errMsg)},fail:function(){console.log("发送失败 "+res.errMsg)}})}),100)},fail:function(){c.devices[e.currentTarget.id].status="disconnected",console.log("连接失败"),wx.showToast({title:"设备连接失败",icon:"none"})}}))},SaveUUID:function(){c.devices[0].services.forEach((function(e,t){-1!=e.uuid.split("-")[0].indexOf("FF00")&&(c.primaryServiceUUID=e.uuid,getApp().globalData.primaryServiceUUID=e.uuid,e.characteristics.forEach((function(e){-1!=e.uuid.split("-")[0].indexOf("03")&&(c.readUUID=e.uuid,getApp().globalData.readUUID=e.uuid),-1!=e.uuid.split("-")[0].indexOf("02")&&(c.writeUUID=e.uuid,getApp().globalData.writeUUID=e.uuid)})))})),console.log(c)}},beforeCreate:function(){console.log("进入连接页面")},created:function(){c=this,c.devices=getApp().globalData.devices,c.primaryServiceUUID=getApp().globalData.primaryServiceUUID,c.readUUID=getApp().globalData.readUUID,c.writeUUID=getApp().globalData.writeUUID},mounted:function(){wx.getBluetoothAdapterState({success:function(e){0==e.available&&wx.openBluetoothAdapter({success:function(){console.log("打开蓝牙适配器成功")},fail:function(){console.log("打开蓝牙适配器失败"),wx.showToast({title:"请打开蓝牙功能",icon:"none"})}})},fail:function(e){wx.openBluetoothAdapter({success:function(){console.log("打开蓝牙适配器成功")},fail:function(){console.log("打开蓝牙适配器失败"),wx.showToast({title:"请打开蓝牙功能",icon:"none"})}})}})}};t.default=i},b42c:function(e,t,n){},e2ab:function(e,t,n){"use strict";var c=n("b42c"),i=n.n(c);i.a}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'pages/links/links-create-component',
    {
        'pages/links/links-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("0372"))
        })
    },
    [['pages/links/links-create-component']]
]);
