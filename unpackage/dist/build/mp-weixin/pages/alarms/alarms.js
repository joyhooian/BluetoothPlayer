(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/alarms/alarms"],{2786:function(e,t,i){"use strict";i.r(t);var a=i("340f"),r=i.n(a);for(var n in a)"default"!==n&&function(e){i.d(t,e,(function(){return a[e]}))}(n);t["default"]=r.a},"2a1d":function(e,t,i){},"340f":function(e,t,i){"use strict";(function(e){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a={name:"alarms",data:function(){return{devices:[],primaryServiceUUID:"",readUUID:"",writeUUID:"",uploadLoading:!1,CustomBar:this.CustomBar,alarmsInfo:[],alarmShow:{},timeAfterInfo:{},weekdaysString:[{index:0,string:"周一"},{index:1,string:"周二"},{index:2,string:"周三"},{index:3,string:"周四"},{index:4,string:"周五"},{index:5,string:"周六"},{index:6,string:"周日"}],fileList:[],selectedFile:null,currentAlarmIndex:null,isShowFileModal:!1}},methods:{Navigate:function(t){"set-time"===t.currentTarget.id?e.navigateTo({url:"/pages/alarms/set-time"}):"time-after"===t.currentTarget.id&&e.navigateTo({url:"/pages/alarms/time-after"})},uploadData:function(){var e=this;if(!this.uploadLoading)if(this.uploadLoading=!0,console.log(this.alarmShow),this.alarmShow.isSetTime){console.log("上传时间设定");var t=new Array;this.alarmsInfo.forEach((function(e,i){if(e.isUsing){var a=new Array;a.push(126),a.push(10+e.weekdays.length),a.push(19),a.push(i+1),a.push(Number(e.startTime.substr(0,2))),a.push(Number(e.startTime.substr(3,2))),a.push(Number(e.stopTime.substr(0,2))),a.push(Number(e.stopTime.substr(3,2))),a.push(e.volume),a.push(e.relayStatus?1:0),e.weekdays.forEach((function(e){a.push(e+1)})),a.push(e.selectedFile?e.selectedFile:0),a.push(239);var r=new Uint8Array(a);t.push(r.buffer)}})),0==t.length?(wx.showToast({title:"请启用要设置的任务!",icon:"none"}),this.uploadLoading=!1):""!=this.primaryServiceUUID&&""!=this.writeUUID?(console.log("发送消息至: Service "+this.primaryServiceUUID+" Write "+this.writeUUID),t.forEach((function(t,i){setTimeout((function(){wx.writeBLECharacteristicValue({deviceId:e.devices[0].deviceId,serviceId:e.primaryServiceUUID,characteristicId:e.writeUUID,value:t,success:function(e){console.log("发送成功"),console.log(t)},fail:function(e){console.log("发送失败")}})}),200*i)})),setTimeout((function(){var t=new Uint8Array([126,2,85,239]);wx.writeBLECharacteristicValue({deviceId:e.devices[0].deviceId,serviceId:e.primaryServiceUUID,characteristicId:e.writeUUID,value:t.buffer,success:function(e){console.log("发送成功"),console.log(t.buffer)},fail:function(e){console.log("发送失败")},complete:function(){e.uploadLoading=!1}})}),200*t.length)):(console.log(t),wx.showToast({title:"请连接设备！",icon:"none"}),this.uploadLoading=!1)}else if(this.alarmShow.isTimeAfter){console.log("上传间隔时间");var i=new Array;i.push(126),i.push(7),i.push(24),i.push((65280&this.timeAfterInfo.secAfter)>>8),i.push(255&this.timeAfterInfo.secAfter),i.push(this.timeAfterInfo.volume),i.push(this.timeAfterInfo.relayStatus?1:0),i.push(this.timeAfterInfo.selectedFile?this.timeAfterInfo.selectedFile:0),i.push(239);var a=new Uint8Array(i);wx.writeBLECharacteristicValue({deviceId:this.devices[0].deviceId,serviceId:this.primaryServiceUUID,characteristicId:this.writeUUID,value:a.buffer,success:function(e){console.log("发送成功"),console.log(a.buffer)},fail:function(e){console.log("发送失败")}})}},ChagngUsing:function(e){this.alarmsInfo[e.currentTarget.id].isUsing=e.detail.value},Edit:function(t){e.navigateTo({url:"/pages/alarms/set-time?index="+t.currentTarget.id})},Download:function(){var t=this;this.primaryServiceUUID?(wx.notifyBLECharacteristicValueChange({deviceId:this.devices[0].deviceId,serviceId:this.primaryServiceUUID,characteristicId:this.readUUID,state:!0,success:function(){console.log("打开监听成功")},fail:function(){console.log("打开监听失败")}}),wx.onBLECharacteristicValueChange((function(i){var a=new Uint8Array(i.value);console.log(a);for(var r=[126,4,32],n=0;n<a.length;n++)for(var s=0;s<3;s++)if(a[n+s]==r[s]&&2==s){t.fileList=[];for(var o=a[n+s+1]<<8|a[n+s+2],l=1;l<=o;l++)t.fileList.push(l);console.log("成功读取"+o+"个文件"),e.showToast({title:"成功读取"+o+"个文件",icon:"none"})}setTimeout((function(){0==t.fileList.length&&e.showToast({title:"没有读取到文件",icon:"none"})}),500)})),setTimeout((function(){var i=new Array;i.push(126),i.push(2),i.push(25),i.push(239);var a=new Uint8Array(i);wx.writeBLECharacteristicValue({deviceId:t.devices[0].deviceId,serviceId:t.primaryServiceUUID,characteristicId:t.writeUUID,value:a.buffer,success:function(t){console.log("发送成功"),console.log(a.buffer),e.showToast({title:"发送成功",icon:"none"})},fail:function(){console.log("发送失败"),e.showToast({title:"发送失败",icon:"none"})}})}),100)):e.showToast({title:"请先连接设备",icon:"none"})},ShowFileModal:function(e){this.currentAlarmIndex=Number(e.currentTarget.id),0==this.fileList.length&&this.Download(),this.isShowFileModal=!0},hideFileModal:function(){this.isShowFileModal=!1,this.currentAlarmIndex=null},FileChange:function(e){this.alarmShow.isSetTime?this.alarmsInfo[this.currentAlarmIndex].selectedFile=e.detail.value:this.timeAfterInfo.selectedFile=e.detail.value},UpdateFile:function(){this.fileList=[],this.Download()}},beforeCreate:function(){},created:function(){i=this,i.alarmsInfo=getApp().globalData.alarmsInfo,i.devices=getApp().globalData.devices,i.primaryServiceUUID=getApp().globalData.primaryServiceUUID,i.readUUID=getApp().globalData.readUUID,i.writeUUID=getApp().globalData.writeUUID,i.alarmShow=getApp().globalData.alarmShow,i.timeAfterInfo=getApp().globalData.timeAfterInfo},mounted:function(){console.log("定时页面")}};t.default=a}).call(this,i("543d")["default"])},a35a:function(e,t,i){"use strict";var a=i("2a1d"),r=i.n(a);r.a},bc19:function(e,t,i){"use strict";i.r(t);var a=i("e1e3"),r=i("2786");for(var n in r)"default"!==n&&function(e){i.d(t,e,(function(){return r[e]}))}(n);i("a35a");var s,o=i("f0c5"),l=Object(o["a"])(r["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],s);t["default"]=l.exports},e1e3:function(e,t,i){"use strict";var a;i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return n})),i.d(t,"a",(function(){return a}));var r=function(){var e=this,t=e.$createElement;e._self._c},n=[]},f9f8:function(e,t,i){"use strict";(function(e){i("29ac");a(i("66fd"));var t=a(i("bc19"));function a(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,i("543d")["createPage"])}},[["f9f8","common/runtime","common/vendor"]]]);